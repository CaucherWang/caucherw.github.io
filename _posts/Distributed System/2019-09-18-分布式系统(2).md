---
layout: post
title: 分布式系统(2)
categories: 分布式系统
description: 分布式系统 Week2
keywords: 分布式系统
---

# 第二章 系统模型

## 2.1 简介

- 分布式系统的困难和威胁

  - 使用模式的多样性：高负载的Web,网络不好的移动端，对带宽有要求的实时多媒体

  - 系统环境的多样性：硬件、OS、网络

  - 内部问题：时钟同步、协定、一致性、故障

  - 外部威胁：DDOS、泄密、破坏

- 物理模型： 描述系统的最显式的方法，系统的**底层硬件**组成和它们之间的互联，从计算机和所用网络技术的特定细节中抽象出来的分布式系统底层硬件元素的表示

- 体系结构模型：描述系统的计算元素执行的计算和通讯任务，用独立指定的组件以及这些**组件**之间的关系来表示的结构

-  基础模型：采用抽象的观点描述分布式系统的某个方面

  - 交互模型：系统元素之间通信的结构和顺序
  - 故障模型：可能不能正确操作的方式
  - 安全模型

## 2.2 物理模型

- 基线物理模型：一组可以扩展的计算机节点，这些节点通过计算机网络相互连接进行所需的消息传递

- 近代互联网节点通常是台式机，因此相对静态的、分立的、自治的

<img src="2019-09-18-%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F(2).assets/image-20191223201301283.png" alt="image-20191223201301283" style="zoom:50%;" />



## 2.3 体系结构模型

### 2.3.1 体系结构元素

#### 通信实体

从系统角度来看，分布式系统中通信的实体通常是**进程**

注意：

- 一些原始环境中（如：传感器网络），操作系统可能不支持进程抽象，因此这些系统中通信的实体是**结点**

- 大多数分布式系统中，用**线程**补充进程。

- 对象：

  在分布式系统中使用面向对象方法：对象通过接口访问，用一个相关的接口定义语言（IDL）提供定义在一个对象上的方法的规约

- 组件：

  与对象类似，通过接口访问；与对象的区别是，显式的给出其他组件/接口的假设

- Web服务：

  - 基于行为封装和通过接口访问
- 利用Web标准表示和发现服务
  

#### 通信方式

-  进程间通信：是指用于分布式系统进程之间通信的相对底层的支持，包括消息传递原语、直接访问由互联网协议提供的API和对多播通信的支持。

-  远程调用：是分布式系统中最常见的通信范型，覆盖一系列分布式系统中通信实体之间基于双向交换的技术，包括调用远程操作、过程或方法。

-  间接通信

  - 通过第三个实体，允许在发送者和接收者之间的深度解耦合

    - 发送者不需要知道正在发送给谁（空间解耦合）

    - 发送者和接收者不需要同时存在（时间解耦合）

  - 组通信
  
- 组通信涉及消息传递给若干接收者，是支持一对多通信的多方通信泛型
  
- 发布—订阅系统
  
  - 大量生产者（或发布者）为大量的消费者（订阅者）发布他们感兴趣的信息项
  
    关键特征：中间服务---用于确保由生产者生成的信息被路由到需要这个信息的消费者
  
- 消息队列
  
  - 提供点对点服务
  
    生产者发送消息到指定队列，消费者能从队列中接收消息，或者被通知队列有消息到达
  
- 元组空间
  
    - 进程可以把任意的结构化数据项（元组）放到一个持久元组空间，其他进程可以指定感兴趣的模式，从而可以在元组空间读取或者删除元组。
-  分布式共享内存（Distributed Shared Memory，DSM）
  
    - 系统提供一种抽象，用于支持在不同共享物理内存的进程之间共享数据

<img src="2019-09-18-%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F(2).assets/image-20191223204824533.png" alt="image-20191223204824533" style="zoom:70%;" />

 

- 客户---服务器模式直接、简单，但是**伸缩性差**，集中化的提供服务和管理，受到**计算机处理资源**和**网络带宽**等资源条件限制大
-  对等体系结构：涉及一项任务或活动的所有进程扮演相同的角色，作为对等方进行交互，不区分客户和服务器或运行它们的计算机，所有参与进程运行相同的程序并且在相互之间提供相同的接口集合，目的是利用大量参与的计算机的资源来完成某个给定的任务或活动
  - Eg. BitTorrent

#### 放置

放置：像对象和服务这样的实体，如何映射到底层物理分布基础设施。

几种放置策略：

- **将服务映射到多个服务器**：像集群一样，将一个服务分布到多个进程上去，然后这些进程相互协调，提供服务
  - 对象集分区或者对象集复制
- **缓存**：将经常访问的服务数据放在一个更靠近客户的位置
  - 例如Web服务，浏览器维护一个本地缓存，访问时查看命中和数据一致性
  - 也有可能多个客户共享一个缓存位置，比如<u>Web代理</u>，Web代理还提供防火墙服务
- **移动代码**：代码在不同的系统间移植，比如applet，不是访问服务，而是直接把运行服务的代码下载下来，在本地运行，这样就与网络无关了。
  - <u>推模式</u>：交互由服务器提起，而不是客户来提起。客户下载一个applet，这个applet在后台运行，可以接收到来自服务器的推送数据。
- **移动代理：**进程在不同的系统间移植。把需要服务的进程直接移植到服务器上去，然后在服务器本地完成任务，然后再把结果返回过来。这样就避免了在网络中频繁的数据传输。

### 2.3.2 体系结构模式

#### 分层体系结构

与抽象紧密相关，一个复杂的系统被分成若干层，每层利用下层提供的服务

- **平台：**一个服务于分布式系统的应用的平台由最底层的硬件和软件层组成
- **中间件**：表示成一组计算机上的**进程**或**对象**，相互交互实现分布式应用的**通信**和**资源共享**支持。是一个软件层，用于屏蔽异构性，给应用程序员提供方便的编程模型。通过对**抽象**的支持提升应用程序通信活动的层次。

#### 层次化体系结构

分层将服务垂直组织成抽象层，层次化用于组织给定层的功能。将分层体系结构中的每一层的功能进行具体的放置（服务器或物理节点）。

##### AJAX

Web所使用的标准客户—服务器交互方式的扩展

满足了Javascript 程序与服务器细粒度通信的需求

标准客户-服务器交互模式的局限性：

- 用户请求一个html页面之后，就和浏览器交互不了了，只能等这个页面完整的返回过来
- 用户有时就想用这个页面的一部分，传来整个页面对于网络是一种负载
- 传到了的页面无法被更新

解决方案：

1. JavaScript是跨平台，跨浏览器的语言，它可以在浏览器中被执行
2. AJAX使得JavaScript可以直接访问服务器的数据，然后有选择地更新来显示新的值

- 用户通过前端组件，利用一个AJAX对象发送一个数据访问请求（异步），然后控制返回浏览器；等到数据返回，就插入/更新到了应有的位置，页面不被刷新
- 比如现代Web的XML，比如一些移动APP，采用的都是这种AJAX技术

#### 瘦客户

分布式计算的趋势是将复杂性从最终用户设备移向互联网服务

- 指的是一个软件层，在执行一个应用程序或访问远程计算机上的服务时，由该软件层提供一个基于窗口的本地用户界面
- 它使得能以很少的对客户设备的假设或需求，获得对复杂网络化服务的访问，这些服务可以通过云解决方案提供

尽量多的把存储和计算逻辑功能放到远程，本地最好只留下一个显示UI的软件层。

由于瘦客户在频繁的图形交互中受网络影响很大，所以诞生了虚拟网格计算VNC这样一种技术来调节。

#### 其他模式

- 代理（Proxy）

  提供远程过程调用或远程方法调用的位置透明

- ？？？

### 2.3.3 相关的中间件解决方案

 中间件的任务是为分布式系统的开发提供一个高层的编程抽象，通过分层对底层基础设施中的异构性提供抽象，从而提升互操作性和可移植性

## 2.4 基础模型

- 交互

  - 计算在进程中发生，进程通过传递消息交互，并引发进程之间的通信和协调

  - 交互模型必须反映通信所带来的延迟

- 故障

  - 分布式系统中任一计算机出现故障或连接他们的网络出现故障，分布式系统的正确操作就会受到威胁

  - 模型要对这些故障进行定义、分类、分析和容忍

- 安全

  - 分布式系统的模块特性和开放性，使其暴露在外部代理和内部代理的攻击下

  - 分析系统的威胁以及设计抵御这些威胁的系统

### 2.4.1 交互模型 

- 分布式算法---定义了组成系统的每个进程所采取的步骤，包括进程之间的消息传递，以便协调每个进程所采取的步骤

-  每个进程有自己的状态，该状态由进程能访问和更新的数据集组成；属于每个进程的状态是私有的

-  影响进程交互的两个重要因素：

  - 通信性能经常是一个限制特性

  - 不可能维护一个全局时间概念

#### 通信信道的性能：

- 通信信道在分布式系统中可用许多方法实现：计算机网络上的流或简单消息传递

- 计算机网络上的通信有下列性能特征：

  - 延迟（Latency）

    从一个进程开始发送消息到另一个进程开始接收消息之间的间隔时间称为延迟

  - 带宽（Bandwidth）

    给定时间内网络能传递的信息总量

  - 抖动（Jitter）

    传递一系列消息所花费的时间的变化值



- 同步分布式系统：

  - 进程执行每一步的时间有一个上限和下限

  - 通过通道传递的每个消息在一个已知的时间范围内接收到

  - 每个进程有一个本地时钟，与实际时间的偏移率在一个已知的范围内

- 异步分布式系统——对下列因素没有限制的系统

  - 进程执行速度

  - 消息传递延迟

  - 时钟漂移率

### 2.4.2 故障模型

#### 遗漏故障

是指进程或者通信通道不能完成它应该做的动作

- 进程遗漏故障中最常见的是进程崩溃

  - 崩溃检测方法依赖**超时**的使用
  - 异步系统中超时只能表明进程没有响应
    - 崩溃、执行速度慢、消息没有送达
  - 故障—停止：如果其它进程能够确切检测到进程崩溃，这个崩溃称之为故障—停止

- 通信遗漏故障：

  -  发送遗漏故障、 接收遗漏故障、 通道遗漏故障
  -  定义为在不同位置的消息丢失

#### 随机故障（拜占庭故障）

用于描述可能出现的最坏的故障，此时可能发生任何类型的错误

- 进程的随机故障
  - 是指进程随机地省略要做的处理步骤或执行一些不需要的处理步骤

- 通信信道随机故障
  - 消息内容被破坏或传递不存在的消息，也可能多次传递实际消息

#### 时序故障

同步系统中才有，三种情况。

------

利用存在故障的组件构造可靠的服务是可能的

一个服务通过隐藏故障或者转换为一个更能接受的故障类型来**屏蔽**故障

 **一对一通信的可靠性**

- 可靠通信可从下列角度定义：

  - 有效性：外发消息缓冲区中的任何消息最终能传递到接受消息缓冲区（不丢）

  - 完整性：接收到的消息与发送消息一致，没有消息被传递两次（不重，不坏）

