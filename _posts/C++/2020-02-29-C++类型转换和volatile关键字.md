---
layout: post
title: C++类型转换与volatile关键字
categories: C++
description: C++类型转换与volatile关键字
keywords: C++
---

# C++类型转换与volatile关键字

## 1. dynamic_cast

​	dynamic_cast专门用来在类继承关系中的上下转换。因为可以隐式转换，即基类指针可以指向派生类对象，向上转换和static_cast一样，都很安全，但是向下转换，即把一个基类指针转换成派生类指针，就没有那么安全了。这需要看基类指针具体指的对象是什么这里只是增加了安全性，不可转换返回nullptr。

​	dynamic_cast还可以用来在同级之间进行类型转换，即一个基类A指针指向一个派生类对象，这个派生类还有另一个基类B，那么将A指针转换为B指针是被允许的。

​	注意，转换的类型只能是指针或引用类型。

## 2. const_cast

​	顾名思义，这个关键字最重要的作用就是删除const标签。比如某个变量大多数时候是const的，在某个位置是需要修改的，那么就可以用这个进行**<u>同类</u>**之间的类型转换，删除const标签。

​	当然，增加const标签也是可以的，除此之外，volatile 标签也可以增删。

​	不过注意，删除const标签未必一定就可以修改了，还要看指向的内容是否是const的。比如一个常量指针，解掉const，只能说明它可以指向比人，指向的内容未必可以修改。

​	同样，转换的类型只能是指针或引用类型。

## 3. static_cast

​	这个转换的用途很多，首先它不受限于指针或引用类型，其次它不受const的约束。总的来说，它的限制只有一条，就是任意一方可以向另一方隐式转换。比如int可以隐式转换为double，那么int->double,double->int，都被static_cast所接受

## 4. reinterpret_cast

​	这个转换更加开放，几乎没有不能转的。其实就是将源类型的bit位进行重新解释。

1. 数据类型指针和函数指针之间不允许互相转换
2. 指针类型不允许转换给更小的类型放不下
3. 不允许删除const

它最主要的作用就是把一个指针解释成整型，然后做转换。或者对结构体、联合体做地址操作。

## volatile关键字

C++volatile关键字(易变的，不稳定的)，用于修饰一个变量，使得这个变量具有以下关键特性：

### 1. 确定内存分配

C++编译器优化有一条策略是<u>常量传播</u>，即可以用常量表示的变量，编译器不再为其分配变量内存，用硬编码的方式，把它的值代入其被用到的指令中，例如

```c++
int i=1;		// i在汇编码中没有内存位置，编译器将其优化为cout<<1<<endl;sum(1,5);
cout<<i<<endl;
sum(i,5);
```

但是如果用volatile关键字，编译器不会如此优化。被修饰的变量，例如上述的$i$，一定有确切的内存位置，通过访存来访问。

### 2. 确保执行顺序

编译器还有一条优化策略就是顺序变换，只要最终结果一致，编译器可以把代码的执行顺序前后调整，进而优化时间。但是在某些情况下，我们不希望一些重要的变量，和它们相关的操作被换顺序，此时可以使用volatile关键字。

被volatile修饰的几个变量之间的操作，编译器不会调整其执行顺序。

但是，注意，volatile变量和普通变量之间的操作，是有可能被调整顺序的。



